<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.jpg">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
</head>



<body>

    <div id="title">Archie Webster</div>



    <div id="butns">
        <button class="button" onclick="window.location.href = 'https://flickr.com/artomweb';">Flickr</button>
        <button class="button" onclick="window.location.href = 'https://github.com/artomweb';">Github</button>
        <button class="button" onclick="window.location.href = 'https://www.thingiverse.com/artomweb2/designs';">Thingiverse</button>
        <button class="button" onclick="window.location.href = 'Projects/Projects 664c3dc51d8c4588becb0db505f9d0cb.html';">Projects</button>

    </div>

    <div class="row">
        <div class="column">
            <div class="subHeadings">
                How much have I slept :)
            </div>

            <canvas id="sleep" class="imageContainer" width='300'></canvas>
        </div>

        <div class="column">
            <div class="subHeadings">
                How many steps have I done
            </div>

            <canvas id="steps" class="imageContainer" width='300'></canvas>
        </div>

    </div>

    <div class="row">
        <div class="column">
            <div class="subHeadings">
                How much have I listened to Spotify
            </div>

            <canvas id="spotify" class="imageContainer" width='300'></canvas>
        </div>

        <div class="column">
            <div class="subHeadings">
                What's my average heart rate
            </div>

            <canvas id="hr" class="imageContainer" width='300'></canvas>
        </div>

    </div>



    <script type="text/javascript">
        colorPallets = [
            ['#62bdc7', '#d8a0a1', '#657786', '#c37777'],
            ["#e07a5f", "#3d405b", "#81b29a", "#f2cc8f"]
            // ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"],
            // ["#cae7b9", "#f3de8a", "#eb9486", "#7e7f9a"]




        ]

        function shuffle(a) {
            var j, x, i;
            for (i = a.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = a[i];
                a[i] = a[j];
                a[j] = x;
            }
            return a;
        }

        colors = colorPallets[Math.floor(Math.random() * colorPallets.length)];
        colors = shuffle(colors);
        var butns = document.getElementById("butns").children;
        var i, e;
        for (i = 0; i < butns.length; i++) {
            e = butns[i];
            e.style.backgroundColor = colors[i];
        }



        var sleepSheet = 'https://docs.google.com/spreadsheets/d/1TqN1Lsj9MxGrfsVrmywdFkLdW3zbqU75zjyslvIRHNM/edit?usp=sharing';

        function init() {
            Tabletop.init({
                key: sleepSheet,
                callback: showInfo,
                simpleSheet: true
            })
        }

        function showInfo(data, tabletop) {
            showSleepGraph(data);
        }

        window.addEventListener('DOMContentLoaded', init)

        function secondsToMins(e) {
            return new Date(1000 * e).toISOString().substr(11, 5)
        }


        function showSleepGraph(allData) {

            allData.sort(function(a, b) {
                return new Date(b.Date).getTime() - new Date(a.Date).getTime();
            });

            console.log(allData.length)

            if (allData.length > 7) {
                allData = allData.slice(0, 7)
            }

            console.log(allData.length)

            var labels = allData.map(function(e) {
                return new Date(e.Date);
            });

            var data = allData.map(function(e) {
                return e.Duration;
            });

            var ctx = document.getElementById('sleep').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{

                        tension: 0.3,
                        data: data,
                        backgroundColor: colors[0]
                    }]
                },

                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    legend: {
                        display: false
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: "day",
                                round: "day",
                                displayFormats: {
                                    day: "MMM D"
                                }
                            }

                        }],
                        yAxes: [{
                            ticks: {
                                callback: function(value, index, values) {
                                    return secondsToMins(value)
                                }
                            }
                        }]

                    },

                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                var label = data.datasets[tooltipItem.datasetIndex].label || '';

                                if (label) {
                                    label += ': ';
                                }

                                label += secondsToMins(tooltipItem.yLabel);
                                return label;

                            }

                        }
                    }
                }
            });
        }






        var stepsSheet = 'https://docs.google.com/spreadsheets/d/15PbAyFyxjhlkCjpsk-VR2v1KsRIQCydOISzUBg88O9o/edit?usp=sharing';

        function stepsInit() {
            Tabletop.init({
                key: stepsSheet,
                callback: showInfo2,
                simpleSheet: true
            })
        }

        function showInfo2(data, tabletop) {
            showStepsGraph(data);
        }

        window.addEventListener('DOMContentLoaded', stepsInit)


        function showStepsGraph(allData) {

            allData.sort(function(a, b) {
                return new Date(a.Date).getTime() - new Date(b.Date).getTime();
            });

            if (allData.length > 7) {
                allData = allData.slice(0, 7)
            }

            var labels = allData.map(function(e) {
                return new Date(e.Date);
            });

            var data = allData.map(function(e) {
                return e.Steps;
            });

            var ctx2 = document.getElementById('steps').getContext('2d');
            var myChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        tension: 0.3,

                        data: data,
                        backgroundColor: colors[1]
                    }]
                },

                options: {
                    maintainAspectRatio: true,
                    responsive: true,

                    legend: {
                        display: false
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: "day",
                                round: "day",
                                displayFormats: {
                                    day: "MMM D"
                                }
                            }

                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]


                    }
                }
            });
        }




        // Spotify





        // var spotifySheet = 'https://docs.google.com/spreadsheets/d/1pu9HWpMBqtemY0J_vviTSZEKmS_LG9hT_RGy6V9iwXE/edit?usp=sharing';
        var spotifySheet = "https://docs.google.com/spreadsheets/d/1MIaLoara96XW_1YfYg9ws7tBo8az0jEcL6OXiNaJncs/edit?usp=sharing";

        function spotifyInit() {
            Tabletop.init({
                key: spotifySheet,
                callback: showInfoSpotify,
                simpleSheet: true
            })
        }

        function showInfoSpotify(data, tabletop) {
            showSpotifyGraph(data);
        }

        window.addEventListener('DOMContentLoaded', spotifyInit)



        function showSpotifyGraph(allData) {

            allData.sort(function(a, b) {
                return new Date(a.Date).getTime() - new Date(b.Date).getTime();
            });

            if (allData.length > 7) {
                allData = allData.slice(0, 7)
            }

            var labels = allData.map(function(e) {
                return new Date(e.Date);
            });

            var data = allData.map(function(e) {
                // return e.Duration;
                return e.Value;
            });

            var ctx2 = document.getElementById('spotify').getContext('2d');
            var myChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        tension: 0.3,

                        data: data,
                        backgroundColor: colors[2]
                    }]
                },

                options: {
                    maintainAspectRatio: true,
                    responsive: true,

                    legend: {
                        display: false
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: "day",
                                round: "day",
                                displayFormats: {
                                    day: "MMM D"
                                }
                            }

                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]


                    }
                }
            });
        }














        var hrSheet = 'https://docs.google.com/spreadsheets/d/1KsHEkF63AQaFQT5Ed0KidRiOewfqT3R40eufufjlGWE/edit?usp=sharing';

        function hrInit() {
            Tabletop.init({
                key: hrSheet,
                callback: showInfoHr,
                simpleSheet: true
            })
        }

        function showInfoHr(data, tabletop) {
            console.log(data)
            showHrGraph(data);
        }

        window.addEventListener('DOMContentLoaded', hrInit)



        function showHrGraph(allData) {

            allData.sort(function(a, b) {
                return new Date(a.Date).getTime() - new Date(b.Date).getTime();
            });

            if (allData.length > 7) {
                allData = allData.slice(0, 7)
            }

            var labels = allData.map(function(e) {
                return new Date(e.Date);
            });

            var data = allData.map(function(e) {
                return parseInt(e.Value);
            });

            var ctx2 = document.getElementById('hr').getContext('2d');
            var myChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        tension: 0.3,

                        data: data,
                        backgroundColor: colors[3]
                    }]
                },

                options: {
                    maintainAspectRatio: true,
                    responsive: true,

                    legend: {
                        display: false
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: "day",
                                round: "day",
                                displayFormats: {
                                    day: "MMM D"
                                }
                            }

                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]


                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                var label = data.datasets[tooltipItem.datasetIndex].label || '';

                                if (label) {
                                    label += ': ';
                                }

                                label += tooltipItem.yLabel + "BPM";
                                return label;

                            }

                        }
                    }
                }
            });
        }
    </script>

</body>

</html>