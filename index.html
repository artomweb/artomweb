<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                "gtm.start": new Date().getTime(),
                event: "gtm.js",
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", "GTM-WM77VVG");
    </script>
    <!-- End Google Tag Manager -->

    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="logo.jpg" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" integrity="sha512-rKFvwjvE4liWPlFnvH4ZhRDfNZ9FOpdkD/BU5gAIA3VS3vOQrQ5BjKgbO3kxebKhHdHcNUHLqxQYSoxee9UwgA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <title>Archie Webster</title>
    <meta name="Description" content="Name: Archie Webster. This is my personal website" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90929098-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag("js", new Date());

        gtag("config", "UA-90929098-3");
    </script>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-WM77VVG"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="title">Archie Webster</div>

    <div id="butns">
        <button class="button flickr-button" onclick="window.location.href = 'https://flickr.com/artomweb';">
        Flickr
      </button>
        <button class="button github-button" onclick="window.location.href = 'https://github.com/artomweb';">
        Github
      </button>
        <button class="button thing-button" onclick="window.location.href = 'https://www.thingiverse.com/artomweb2/designs';">
        Thingiverse
      </button>
        <button class="button projects-button" onclick="window.location.href = 'https://dev.to/artomweb';">
        Projects
      </button>
    </div>

    <div class="row">
        <div class="column">
            <div class="subHeadings">How much have I slept :)</div>

            <canvas id="sleep" class="imageContainer" width="300"></canvas>
        </div>

        <div class="column">
            <div class="subHeadings">How many steps have I done</div>

            <canvas id="steps" class="imageContainer" width="300"></canvas>
        </div>
    </div>

    <div class="row">
        <div class="column">
            <div class="subHeadings">How much Spotify?</div>

            <canvas id="spotify" class="imageContainer" width="300"></canvas>
        </div>

        <div class="column">
            <div class="subHeadings">What's my average heart rate</div>

            <canvas id="hr" class="imageContainer" width="300"></canvas>
        </div>
    </div>

    <div class="subHeadings">Who has visited this site?</div>

    <div class="mapContainer" style="">
        <div id="svgMap" style="text-align: center; max-height: 15%; margin: 0 auto"></div>
    </div>
    <script type="text/javascript">
        let mapCnData = {};
        let webAppUrl =
            "https://script.google.com/macros/s/AKfycbzOKBcpmXpn5iryKAqjzm9dfoaEdiMu2472VPDaEi9DAJF5lGpntNvPcA3sW3sOG8X8Jg/exec";

        async function getCountry() {
            let response = await fetch(
                "https://api.ipdata.co?api-key=fa280914a5a8b8bb232f12221300ad1638d203fba26689340fba63f9"
            );
            let country = await response.json();
            console.log(country);
            let body = {
                countryCode: country.country_name,
            };
            console.log(body);
            // let success = await fetch(webAppUrl, {
            //     method: "POST",
            //     mode: "no-cors",
            //     body: JSON.stringify(body),
            // });
            // success = await success.json();
            return success;
        }

        function sendCountryCode() {
            getCountry()
                .then((resp) => {
                    console.log("COUNTRY", resp);
                })
                .catch((error) => console.log("ERROR", error));
        }

        let mapSheet =
            "https://docs.google.com/spreadsheets/d/e/2PACX-1vSRGkSebakEqYSJa9f6eBXJqNlmgy9JWhSFxbjV--duEF-WIPy9tirqIJHdyuuUmo-JTp1zFKB9M9SW/pub?output=csv";

        function mapInit() {
            Papa.parse(mapSheet, {
                download: true,
                header: true,
                complete: showMap,
            });
        }

        var resizeTimer;

        window.onresize = function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                drawMapChart(mapCnData);
            }, 250);
        };

        function drawMapChart(dataVis) {
            google.charts.load("current", {
                packages: ["geochart"],
                mapsApiKey: "AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY",
            });
            google.charts.setOnLoadCallback(drawRegionsMap);

            function drawRegionsMap() {
                var data = new google.visualization.DataTable();

                data.addColumn("string", "Country");
                data.addColumn("number", "Visits");

                for (var i = 0; i < dataVis.length; i++) {
                    data.addRow([dataVis[i].Country, parseInt(dataVis[i].Visitors)]);
                }

                var options = {
                    // backgroundColor: "#bbdef9",
                    colorAxis: {
                        // colors: ["#06d6a0", "#ef476f"],
                        colors: ["264653", "2a9d8f", "e9c46a", "f4a261", "e76f51"],
                    },
                    datalessRegionColor: "#bfdbf7",
                };

                var chart = new google.visualization.GeoChart(
                    document.getElementById("svgMap")
                );

                chart.draw(data, options);
            }
        }

        function showMap(dataIN) {
            let dataVis = dataIN.data;
            mapCnData = dataVis;
            console.log(dataVis);
            sendCountryCode();
            drawMapChart(dataVis);
        }

        mapInit();

        colorPallets = [
            // ["#62bdc7", "#d8a0a1", "#657786", "#c37777"],
            ["#e07a5f", "#3d405b", "#81b29a", "#f2cc8f"],
            // ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"],
            // ["#cae7b9", "#f3de8a", "#eb9486", "#7e7f9a"]
        ];

        function shuffle(a) {
            let j, x, i;
            for (i = a.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = a[i];
                a[i] = a[j];
                a[j] = x;
            }
            return a;
        }

        colors = colorPallets[Math.floor(Math.random() * colorPallets.length)];
        colors = shuffle(colors);
        let butns = document.getElementById("butns").children;
        let i, e;
        for (i = 0; i < butns.length; i++) {
            e = butns[i];
            e.style.backgroundColor = colors[i];
        }
    </script>
    <script src="graphs.js"></script>
</body>

</html>