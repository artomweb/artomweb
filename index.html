<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                "gtm.start": new Date().getTime(),
                event: "gtm.js",
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, "script", "dataLayer", "GTM-WM77VVG");
    </script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
    <title>artomweb</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90929098-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag("js", new Date());

        gtag("config", "UA-90929098-3");
    </script>
</head>

<body style="height: 100%; overflow: scroll; -webkit-overflow-scrolling: touch">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-WM77VVG"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->

    Heyy, here are some cat facts while you wait for me to make this website:

    <br />
    <br />
    <div id="factContainer"></div>

    <br />
    <br />These are the people who have visited this website:
    <br />
    <br />

    <div id="visitors"></div>

    <br />
    <br />This is my spotify history
    <br />
    <br />

    <div id="spotify"></div>

    <script type="text/javascript">
        let pubData = [];

        function showCatFacts(facts) {
            const container = document.getElementById("factContainer");
            const factsList = facts.map((fact) => {
                return "<li>" + fact.fact + "</li>";
            });

            // console.log(factsList);

            container.innerHTML = factsList.join("");
        }

        function showCountryData(data) {
            const container = document.getElementById("visitors");

            data = data.sort((a, b) => {
                return b.Users - a.Users;
            });

            const countryList = data.map((cntry) => {
                if (cntry.Users != 1) {
                    return "<li>" + cntry.Country + ": " + cntry.Users + " people</li>";
                }
                return "<li>" + cntry.Country + ": " + cntry.Users + " person</li>";
            });
            container.innerHTML = countryList.join("");
        }

        function showSpotify(data) {
            data.shift();
            const container = document.getElementById("spotify");
            const factsList = data.map((elt) => {
                return "<li>" + elt[0] + ": " + elt[1] + "</li>";
            });

            // console.log(factsList);

            container.innerHTML = factsList.join("");
        }

        function newShowSpotify(data) {
            const container = document.getElementById("spotify");
            const factsList = data.map((elt) => {
                return "<li>" + elt.Date + ": " + elt.Value + "</li>";
            });

            // console.log(factsList);

            container.innerHTML = factsList.join("");
        }

        async function fetchCatFacts() {
            const response = await fetch(
                "https://catfact.ninja/facts?limit=5&max_length=140"
            );

            const json = await response.json();

            showCatFacts(json.data);
        }

        async function fetchScript() {
            const response = await fetch(
                "https://script.google.com/macros/s/AKfycbwxxNcm0vcgxkmbBtIKDRCuS23Szfsh-adzbXL4v8w0Ylsq7XvlVxPAJAZI6rMulAOY-Q/exec"
            );

            const json = await response.json();

            showCountryData(json);
        }

        async function fetchSpotify() {
            const response = await fetch(
                "https://script.google.com/macros/s/AKfycbxnK0twv4o0qhb1cjk6-EMPFyW-be5DNi6W2x40HVNgvUuqtW0toHbjaBavyyaD1zbH/exec"
            );

            const json = await response.json();

            // console.log(json);
            showSpotify(json);
        }

        async function newFetchSpotify() {
            const response = await fetch(
                "https://spreadsheets.google.com/feeds/list/1UYWe_3L4NiBU8_bwAbI1XTIRCToCDkOF44wUWVQ2gRE/1/public/full?alt=json"
            );

            const json = await response.json();

            let data = json.feed.entry.map((elt) => {
                return {
                    Date: elt.gsx$date.$t,
                    Value: elt.gsx$value.$t,
                };
            });

            console.log(data);

            newShowSpotify(data);
        }

        newFetchSpotify();
        // fetchSpotify();
        fetchScript();
        fetchCatFacts();
    </script>
</body>

</html>